// Remove the environment precheck query and state, and the associated useEffect hook
EDIT FILE
src/instrumentation.tsx
// Add: environment precheck to surface actionable toasts once
const envStatus = useQuery(api.health.envStatus as any, hasConvex ? ({} as any) : undefined);
const [envToastsShown, setEnvToastsShown] = useState(false);

useEffect(() => {
  if (!hasConvex || !envStatus || envToastsShown) return;
  try {
    const hasResend = Boolean((envStatus as any)?.hasRESEND);
    const hasSalesInbox = Boolean(
      (envStatus as any)?.hasSALES_INBOX || (envStatus as any)?.hasPUBLIC_SALES_INBOX
    );
    const hasBaseUrl = Boolean((envStatus as any)?.hasBASE_URL);
    const devSafeEmails = Boolean((envStatus as any)?.devSafeEmailsEnabled);

    if (!hasResend) {
      console.warn("[ENV] RESEND_API_KEY is missing. Email delivery is disabled.");
      // Use generic toast to avoid any type/version issues
      toast("Email delivery is disabled (missing RESEND_API_KEY). Enable it or set DEV_SAFE_EMAILS=true to stub.");
    }
    if (!hasSalesInbox) {
      console.warn("[ENV] SALES_INBOX/PUBLIC_SALES_INBOX is missing. Sales inquiries cannot be delivered.");
      toast("Sales inbox is not configured. Set SALES_INBOX or PUBLIC_SALES_INBOX.");
    }
    if (!hasBaseUrl) {
      console.warn("[ENV] VITE_PUBLIC_BASE_URL is missing. Unsubscribe links may be invalid.");
      toast("Public base URL missing. Set VITE_PUBLIC_BASE_URL for correct unsubscribe links.");
    }
    if (devSafeEmails) {
      console.info("[ENV] DEV_SAFE_EMAILS enabled. Outbound emails will be stubbed.");
      toast("DEV safe mode is ON. Emails are stubbed, not sent.");
    }
  } catch (e) {
    console.error("Failed to show env toasts:", e);
  } finally {
    setEnvToastsShown(true);
  }
}, [hasConvex, envStatus, envToastsShown]);